{"version":3,"file":"rpc-message-types.js","sourceRoot":"","sources":["../../src/rpc-message-types.ts"],"names":[],"mappings":";AAAA;;;;;;GAMG","sourcesContent":["/**\r\n * Types describing the message object format that the library sends over the channel.\r\n *\r\n * These are for internal type safety, not to be used by the user.\r\n * @module\r\n * @internal\r\n */\r\n\r\nimport type { ClassDescriptors, ObjectDescriptors } from './rpc-descriptor-types';\r\nimport { FunctionDescriptors } from './rpc-descriptor-types';\r\n\r\nexport type RPC_Marker = { rpc_marker?: 'srpc' };\r\n\r\n// descriptor request & response\r\nexport type RPC_GetDescriptorsMessage = RPC_Marker & { action: 'get_descriptors' };\r\nexport type RPC_DescriptorsResultMessage = RPC_Marker & { action: 'descriptors',\r\n    objects: ObjectDescriptors,\r\n    functions: FunctionDescriptors,\r\n    classes: ClassDescriptors\r\n};\r\n\r\n// function call messages\r\nexport type RPC_FnCallMessageBase = RPC_Marker & { objId: string, args: any[] };\r\n//  - 3 types (void, sync, async), only async needs a callId for correlating the response message\r\nexport type RPC_VoidFnCallMessage = RPC_FnCallMessageBase & { callType: 'void' };\r\nexport type RPC_SyncFnCallMessage = RPC_FnCallMessageBase & { callType: 'sync' };\r\nexport type RPC_AsyncFnCallMessage = RPC_FnCallMessageBase & { callType: 'async', callId: string };\r\nexport type RPC_AnyCallTypeFnCallMessage = RPC_VoidFnCallMessage | RPC_SyncFnCallMessage | RPC_AsyncFnCallMessage;\r\n//  - different actions may have different calltypes\r\nexport type RPC_FnCallMessage = { action: 'fn_call' } & RPC_AnyCallTypeFnCallMessage;\r\nexport type RPC_CtorCallMessage = { action: 'ctor_call' } & (RPC_SyncFnCallMessage | RPC_AsyncFnCallMessage);\r\nexport type RPC_PropGetMessage = { action: 'prop_get', prop: string } & (RPC_SyncFnCallMessage | RPC_AsyncFnCallMessage);\r\nexport type RPC_PropSetMessage = { action: 'prop_set', prop: string } & (RPC_VoidFnCallMessage | RPC_SyncFnCallMessage);\r\nexport type RPC_RpcCallMessage = { action: 'method_call', prop: string } & RPC_AnyCallTypeFnCallMessage;\r\n\r\nexport type RPC_AnyCallMessage = RPC_FnCallMessage | RPC_CtorCallMessage | RPC_PropGetMessage | RPC_PropSetMessage | RPC_RpcCallMessage;\r\n\r\n// extract the \"action\" types for specific calltypes\r\nexport type RPC_AnyCallAction = RPC_AnyCallMessage['action'];\r\nexport type RPC_VoidCallAction = (RPC_AnyCallMessage & { callType: 'void' })['action'];\r\nexport type RPC_SyncCallAction = (RPC_AnyCallMessage & { callType: 'sync' })['action'];\r\nexport type RPC_AsyncCallAction = (RPC_AnyCallMessage & { callType: 'async' })['action'];\r\n\r\n// function call result messages\r\nexport type RPC_FnResultMessageBase = RPC_Marker & { action: 'fn_reply', success: boolean; result: any };\r\nexport type RPC_SyncFnResultMessage = RPC_FnResultMessageBase & { callType: 'sync' };\r\nexport type RPC_AsyncFnResultMessage = RPC_FnResultMessageBase & { callType: 'async', callId: string };\r\nexport type RPC_FnResultMessage = RPC_SyncFnResultMessage | RPC_AsyncFnResultMessage;\r\n\r\nexport type RPC_ObjectDiedMessage = RPC_Marker & { action: 'obj_died', objId: string };\r\nexport type RPC_AsyncCallbackCallMessage = RPC_Marker & { action: 'async_fn', objId: string, args: any[] };\r\n\r\n// the generic message type\r\nexport type RPC_Message = RPC_GetDescriptorsMessage | RPC_DescriptorsResultMessage |\r\n    RPC_AnyCallMessage | RPC_FnResultMessage | RPC_AsyncCallbackCallMessage | RPC_ObjectDiedMessage;\r\n"]}